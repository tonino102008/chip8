#include "../include/types.h"
#include "../include/system.h"
#include "../include/memory.h"
#include "../include/stack.h"
#include "../include/register.h"
#include "../include/display.h"

#include "string.h"
#include "unistd.h"

int main(int argc, char** argv) {
    byte_t commands[] = {   0x00, 0xE0, 0xA2, 0x2A, 0x60, 0x0C, 0x61, 0x08, 0xD0, 0x1F, 0x70, 0x09, 0xA2, 0x39, 0xD0, 0x1F,
                            0xA2, 0x48, 0x70, 0x08, 0xD0, 0x1F, 0x70, 0x04, 0xA2, 0x57, 0xD0, 0x1F, 0x70, 0x08, 0xA2, 0x66, 
                            0xD0, 0x1F, 0x70, 0x08, 0xA2, 0x75, 0xD0, 0x1F, 0x12, 0x28, 0xFF, 0x00, 0xFF, 0x00, 0x3C, 0x00, 
                            0x3C, 0x00, 0x3C, 0x00, 0x3C, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x38, 0x00, 0x3F, 
                            0x00, 0x3F, 0x00, 0x38, 0x00, 0xFF, 0x00, 0xFF, 0x80, 0x00, 0xE0, 0x00, 0xE0, 0x00, 0x80, 0x00, 
                            0x80, 0x00, 0xE0, 0x00, 0xE0, 0x00, 0x80, 0xF8, 0x00, 0xFC, 0x00, 0x3E, 0x00, 0x3F, 0x00, 0x3B, 
                            0x00, 0x39, 0x00, 0xF8, 0x00, 0xF8, 0x03, 0x00, 0x07, 0x00, 0x0F, 0x00, 0xBF, 0x00, 0xFB, 0x00, 
                            0xF3, 0x00, 0xE3, 0x00, 0x43, 0xE0, 0x00, 0xE0, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 
                            0x00, 0xE0, 0x00, 0xE0};
    
    init_memory();
    memcpy(&memory[PC], commands, (size_t)sizeof(commands)/sizeof(byte_t));
    init_fb();
    clean_Vscreen();
    sleep(1);
    word_t tmpPC = 0x0000;
    while (PC != tmpPC)
    {
        word_t opcode = (memory[PC] << 8) | memory[PC + 1];
        opcode_switch(opcode);
        sleep(1);
        tmpPC = PC;
        PC += 0x0002;
    }
    sleep(1);
    clean_Vscreen();
    sleep(1);
    close_fb();

    return 0;
}